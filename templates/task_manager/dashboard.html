{% extends 'task_manager/common/dashboard_base.html' %}

{% block dasboard_content %}
    <div class="container-fluid">

        <div class="d-sm-flex align-items-center justify-content-between mb-4">
        </div>
        <div class="row">

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Earnings
                                    (Monthly)
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">$40,000</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-calendar fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Earnings
                                    (Annual)
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">$215,000</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Earnings (Monthly) Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-info shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Tasks</div>
                                <div class="row no-gutters align-items-center">
                                    <div class="col-auto">
                                        <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">50%</div>
                                    </div>
                                    <div class="col">
                                        <div class="progress progress-sm mr-2">
                                            <div class="progress-bar bg-info" role="progressbar"
                                                 style="width: 50%" aria-valuenow="50" aria-valuemin="0"
                                                 aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Requests Card Example -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Pending
                                    Requests
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">18</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-comments fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <!-- Area Chart -->
            {% for task in tasks %}
                <div class="col-xl-6 col-lg-6">
                    <div class="card border-left-info shadow mb-4">
                        <!-- Card Header - Dropdown -->
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">{{ task.task_name }}</h6>
                            <div class="dropdown no-arrow">
                                <a href="#" class="btn btn-info btn-circle" onclick="additionalInfo({{ task.id }})">
                                    <i class="fas fa-info-circle"></i>
                                </a>
                            </div>
                        </div>
                        <!-- Card Body -->
                        <div class="card-body">
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Status <span
                                        class="badge badge-primary badge-pill">{{ task.get_status_display|upper }}</span>
                                    {% if task.status == 'complete' %}
                                        <i class="fas fa-check-circle fa-2x" style="color: green"></i>
                                    {% elif task.status == 'incomplete' %}
                                        <i class="fas fa-times-circle fa-2x" style="color: red"></i>
                                    {% elif task.status == 'outstanding' %}
                                        <i class="fas fa-exclamation-triangle fa-2x" style="color: yellow"></i>
                                    {% elif task.status == 'no_status' %}
                                        <i class="fas fa-power-off fa-2x"></i>
                                    {% endif %}
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Updated by
                                    <span class="badge badge-primary badge-pill">{{ task.updated_by|upper }}</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Updated at
                                    <span class="badge badge-primary badge-pill">{{ task.updated_at }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            {% endfor %}

        </div>
        {% if tasks.has_other_pages %}
            <nav aria-label="...">
                <ul class="pagination">
                    {% if tasks.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ tasks.previous_page_number }}"
                               tabindex="-1">Previous</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link" tabindex="-1">Previous</span>
                        </li>
                    {% endif %}
                    {% for i in tasks.paginator.page_range %}
                        {% if tasks.number == i %}
                            <li class="page-item active">
                                <span class="page-link">{{ i }} <span class="sr-only">(current)</span></span>
                            </li>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ i }}">{{ i }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    {% if tasks.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ tasks.next_page_number }}">Next</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">Next</span>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    </div>

    <script>
        function additionalInfo (pk)  {
            // e.preventDefault()
            console.log(pk)
            $.ajax({
                'url': "/task/additional/"+pk,
                'type': 'GET',
                beforeSend: function () {
                    alert(pk);
                },
                error: function () {
                    alert('Error');
                },
                'success': function (data) {
                    if (data === "success") {
                        alert('request sent!');
                    }
                }
            })
        }
        {% comment %}$(document).ready(function () {
            // selector has to be . for a class name and # for an ID
            $('#add{{ name }}').click(function (e) {
                e.preventDefault(); // prevent form from reloading page
                alert("hiii");

                $.ajax({
                    'url': 'localhost:[port_number_web_server]/blah/blah/blah',
                    'type': 'GET',
                    beforeSend: function () {
                        alert(1);
                    },
                    error: function () {
                        alert('Error');
                    },
                    'success': function (data) {
                        if (data == "success") {
                            alert('request sent!');
                        }
                    }
                });
            });
        });{% endcomment %}
    </script>

    <div class="modal fade" id="additional" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="{% url 'logout' %}">Logout</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}